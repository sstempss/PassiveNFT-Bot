#!/usr/bin/env python3
"""
üîÑ PassiveNFT Bot Pinger
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ "–ø—Ä–æ–±—É–∂–¥–∞–µ—Ç" –±–æ—Ç–∞ –Ω–∞ Render.com –∫–∞–∂–¥—ã–µ 14 –º–∏–Ω—É—Ç
—á—Ç–æ–±—ã –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –∑–∞—Å—ã–ø–∞–Ω–∏–µ –Ω–∞ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–º –ø–ª–∞–Ω–µ.

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
    python bot_pinger.py

–ò–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤ —Ñ–æ–Ω–µ:
    nohup python bot_pinger.py &
"""

import requests
import time
import logging
from datetime import datetime

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('pinger.log'),
        logging.StreamHandler()
    ]
)

logger = logging.getLogger(__name__)

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
BOT_URL = "https://passivenft-bot.onrender.com"
PING_INTERVAL = 14 * 60  # 14 –º–∏–Ω—É—Ç (–º–µ–Ω—å—à–µ 15, —á—Ç–æ–±—ã –æ–ø–µ—Ä–µ–¥–∏—Ç—å –∑–∞—Å—ã–ø–∞–Ω–∏–µ)
TIMEOUT = 10  # –¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö

def ping_bot():
    """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç HTTP-–∑–∞–ø—Ä–æ—Å –∫ –±–æ—Ç—É –¥–ª—è –µ–≥–æ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏—è."""
    try:
        logger.info(f"üì° –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–∏–Ω–≥–∞ –Ω–∞ {BOT_URL}")
        
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º HEAD –∑–∞–ø—Ä–æ—Å –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤
        response = requests.head(BOT_URL, timeout=TIMEOUT)
        
        if response.status_code == 200:
            logger.info(f"‚úÖ –ü–∏–Ω–≥ —É—Å–ø–µ—à–µ–Ω! HTTP {response.status_code}")
            return True
        else:
            logger.warning(f"‚ö†Ô∏è –ù–µ–æ–±—ã—á–Ω—ã–π —Å—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞: HTTP {response.status_code}")
            return False
            
    except requests.exceptions.Timeout:
        logger.error("‚è∞ –¢–∞–π–º–∞—É—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è")
        return False
    except requests.exceptions.ConnectionError:
        logger.error("üîå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è")
        return False
    except Exception as e:
        logger.error(f"‚ùå –ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞: {e}")
        return False

def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–∏–Ω–≥–∞."""
    logger.info("üöÄ PassiveNFT Bot Pinger –∑–∞–ø—É—â–µ–Ω")
    logger.info(f"üéØ –¶–µ–ª—å: {BOT_URL}")
    logger.info(f"‚è∞ –ò–Ω—Ç–µ—Ä–≤–∞–ª: {PING_INTERVAL // 60} –º–∏–Ω—É—Ç")
    
    ping_count = 0
    
    while True:
        try:
            ping_count += 1
            current_time = datetime.now().strftime("%H:%M:%S")
            
            logger.info(f"üî• –ü–∏–Ω–≥ #{ping_count} –≤ {current_time}")
            
            if ping_bot():
                logger.info("üíö –ë–æ—Ç –∞–∫—Ç–∏–≤–µ–Ω –∏ –æ—Ç–≤–µ—á–∞–µ—Ç")
            else:
                logger.warning("üü° –ë–æ—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω")
            
            # –ñ–¥–µ–º —Å–ª–µ–¥—É—é—â–∏–π –ø–∏–Ω–≥
            time.sleep(PING_INTERVAL)
            
        except KeyboardInterrupt:
            logger.info("üõë –ü–æ–ª—É—á–µ–Ω —Å–∏–≥–Ω–∞–ª –æ—Å—Ç–∞–Ω–æ–≤–∫–∏. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã...")
            break
        except Exception as e:
            logger.error(f"üí• –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {e}")
            # –ü—Ä–∏ –æ—à–∏–±–∫–µ –∂–¥–µ–º –º–µ–Ω—å—à–µ –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–æ–π
            time.sleep(60)

if __name__ == "__main__":
    main()
